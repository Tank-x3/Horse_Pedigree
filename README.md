# 5代血統表 作成ツール

Webブラウザ上で動作する、競走馬の5代血統表作成・管理ツールです。
架空馬（ウイニングポスト等のゲーム用やオリウマ（オリジナルウマ娘））から実在馬まで、血統データをクラウド上の共有データベースで管理し、血統表画像を生成できます。

## 概要

このツールは、入力された馬データをもとに5代血統表を動的に生成します。
入力データは Google Apps Script (GAS) を介してクラウドデータベースに保存され、他のユーザーとデータを共有・再利用することができます。また、自動的なクロス（インブリード）判定機能や、画像出力機能を備えています。

## 主な機能

### 1. 血統表の作成とプレビュー
*   **2代〜5代表示:** 用途に合わせて表示世代数を切り替え可能です。
*   **リアルタイムプレビュー:** 入力内容は即座に右側のプレビュー表に反映されます。
*   **オートコンプリート:** データベースに登録済みの馬は、名前を入力するだけで候補が表示され、選択すると親系統まで自動で展開されます。
*   **入力ジャンプ:** プレビュー表のセルをクリック（タップ）すると、該当する入力フォームへ自動スクロールします。

### 2. 高度なクロス（インブリード）判定
*   **自動計算:** 5代以内の血統情報から、クロスを自動的に検出・計算します。
*   **精密なロジック:** 
    *   全きょうだいクロス（例: Fairway = Pharos）と同一馬クロスを区別して判定。
    *   独立した血統ラインと、既存クロスを経由するラインを識別し、正確な血量を算出します。
    *   親子の包含関係を考慮し、冗長なクロス（子が全てカバーしている親クロス）は自動的に除外します。
*   **強調表示:** クロスが発生している馬は赤字で強調され、リスト形式で詳細（血量・世代数）が表示されます。

### 3. データの保存と共有
*   **共有データベース (Cloud):** 登録したデータはクラウドサーバーに送信され、全ユーザーで共有されます。次回以降、誰もがその馬を呼び出すことができます。
*   **競合解決機能:** 保存時にサーバー上のデータと差異がある場合、差分を表示し、「更新」「維持（保存しない）」「新規登録」を選択できます。
*   **ローカル保存 (CSV):** データベースの内容をCSVファイルとして手元にダウンロード・バックアップできます。また、CSVファイルを読み込んで復元することも可能です。

### 4. 画像出力
*   **PNG保存:** 作成した血統表を画像ファイルとしてダウンロードできます。
*   **シンプルモード:** 詳細情報を隠し、馬名と生年のみを強調した「シンプル表示」に切り替えることができ、SNSでの共有等に最適です。

---

## 入力できる項目

各馬に対し、以下の情報を登録できます。

### 基本情報
*   **カナ馬名:** 日本語の馬名（必須項目 ※架空馬チェック時は任意）。
*   **欧字馬名:** アルファベットの馬名（実在馬の場合は原則必須）。
*   **生年:** 西暦（4桁）。名寄せ（同一馬判定）の重要なキーとなります。
*   **架空馬フラグ:** チェックを入れると、欧字名や生年が不明でも登録可能になります。

### 詳細情報（任意）
*   **生産国:** (例: USA, JPN, IRE)
*   **毛色:** (例: 鹿毛, 栗毛)
*   **F-No.:** ファミリーナンバー (例: 1-x, 9-f)
*   **系統:** サイアーラインや牝系情報 (例: Halo系, Hail to Reason系)

---

## 運用ルールと注意事項

本ツールは**「共有データベース」**を使用しています。データの品質を保つため、以下の点にご協力ください。

1.  **実在馬の登録:**
    *   実在馬を登録する際は、重複を防ぐため可能な限り**「欧字馬名」**と**「生年」**を正確に入力してください。
    *   正式な欧字名が不明な日本馬などの場合は、ローマ字読みを入力してください。
2.  **データの更新:**
    *   「詳細情報が含まれている既存データ」を、「詳細情報のない簡易データ」で上書きしないようご注意ください。
    *   保存時に競合警告が出た際は、差分を確認し、適切な処置（DBの情報を維持する 等）を選択してください。
3.  **架空馬の扱い:**
    *   ゲーム内のオリジナル馬など、実在しない馬を登録する場合は必ず**「架空馬」チェックボックス**をONにしてください。
